#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("connect");
var commander = require("commander");
var apis_1 = require("./commands/apis");
var clone_1 = require("./commands/clone");
var create_1 = require("./commands/create");
var defaultCmd_1 = require("./commands/defaultCmd");
var deploy_1 = require("./commands/deploy");
var deployments_1 = require("./commands/deployments");
var help_1 = require("./commands/help");
var list_1 = require("./commands/list");
var login_1 = require("./commands/login");
var logout_1 = require("./commands/logout");
var logs_1 = require("./commands/logs");
var openCmd_1 = require("./commands/openCmd");
var pull_1 = require("./commands/pull");
var push_1 = require("./commands/push");
var run_1 = require("./commands/run");
var setting_1 = require("./commands/setting");
var status_1 = require("./commands/status");
var undeploy_1 = require("./commands/undeploy");
var version_1 = require("./commands/version");
var versions_1 = require("./commands/versions");
var utils_1 = require("./utils");
// CLI
/**
 * Set global CLI configurations
 */
commander
    .name(utils_1.PROJECT_NAME)
    .usage("<command> [options]")
    .description(utils_1.PROJECT_NAME + " - The Apps Script CLI");
/**
 * Logs the user in. Saves the client credentials to an rc file.
 * @name login
 * @param {string?} [--no-localhost] Do not run a local server, manually enter code instead.
 * @param {string?} [--creds] Relative path to credentials (from GCP).
 * @example login (uses default clasp credentials)
 * @example login --creds credentials.json (uses your credentials file).
 * @see test
 */
commander
    .command('login')
    .description('Log in to script.google.com')
    .option('--no-localhost', 'Do not run a local server, manually enter code instead')
    .option('--creds <file>', 'Relative path to credentials (from GCP).')
    .action(utils_1.handleError(login_1.default));
/**
 * Logs out the user by deleteing client credentials.
 * @name logout
 * @example logout
 */
commander
    .command('logout')
    .description('Log out')
    .action(utils_1.handleError(logout_1.default));
/**
 * Creates a new script project.
 * @name create
 * @param {string?} [--title] An optional project title.
 * @param {string?} [--parentId] An optional project parent Id. The Drive ID of a parent file
 *   that the created script project is bound to. This is usually the ID of a
 *   Google Doc, Google Sheet, Google Form, or Google Slides file. If not set, a
 *   standalone script project is created.
 *   https://drive.google.com/open?id=<ID>
 * @param {string?} [--rootDir] Local root directory that store your project files.
 * @example create
 * @example create "My Script"
 * @example create "My Script" "1D_Gxyv*****************************NXO7o"
 * @see https://developers.google.com/apps-script/api/reference/rest/v1/projects/create
 */
commander
    .command('create')
    .description('Create a script')
    .option('--type <type>', 'Creates a new add-on attached to a new Document, Spreadsheet, Presentation, or Form.')
    .option('--title <title>', 'The project title.')
    .option('--parentId <id>', 'A project parent Id.')
    .option('--rootDir <rootDir>', 'Local root directory in which clasp will store your project files.')
    .action(utils_1.handleError(create_1.default));
/**
 * Fetches a project and saves the script id locally.
 * @param {string?} [scriptId] The script ID to clone.
 * @param {string?} [versionNumber] The version of the script to clone.
 * @param {string?} [--rootDir] Local root directory that store your project files.
 */
commander
    .command('clone [scriptId] [versionNumber]')
    .description('Clone a project')
    .option('--rootDir <rootDir>', 'Local root directory in which clasp will store your project files.')
    .action(utils_1.handleError(clone_1.default));
/**
 * Fetches a project from either a provided or saved script id.
 * Updates local files with Apps Script project.
 * @name pull
 * @example pull
 */
commander
    .command('pull')
    .description('Fetch a remote project')
    .option('--versionNumber <version>', 'The version number of the project to retrieve.')
    .action(utils_1.handleError(pull_1.default));
/**
 * Force writes all local files to the script management server.
 * @name push
 * @desc Ignores files:
 * - That start with a .
 * - That don't have an accepted file extension
 * - That are ignored (filename matches a glob pattern in the ignore file)
 * @example push
 * @example push --force
 * @example push --watch
 */
commander
    .command('push')
    .description('Update the remote project')
    .option('-f, --force', 'Forcibly overwrites the remote manifest.')
    .option('-w, --watch', 'Watches for local file changes. Pushes when a non-ignored file changs.')
    .action(utils_1.handleError(push_1.default));
/**
 * Lists files that will be written to the server on `push`.
 * @name status
 * @desc Ignores files:
 * - That start with a .
 * - That don't have an accepted file extension
 * - That are ignored (filename matches a glob pattern in the ignore file)
 * @example status
 */
commander
    .command('status')
    .description('Lists files that will be pushed by clasp')
    .option('--json', 'Show status in JSON form')
    .action(utils_1.handleError(status_1.default));
/**
 * Opens the `clasp` project on script.google.com. Provide a `scriptId` to open a different script.
 * @name open
 * @param {string?} [scriptId] The optional script project to open.
 * @example open
 * @example open [scriptId]
 */
commander
    .command('open [scriptId]')
    .description('Open a script')
    .option('--webapp', 'Open web application in the browser')
    .option('--creds', 'Open the URL to create credentials')
    .action(utils_1.handleError(openCmd_1.default));
/**
 * List deployments of a script
 * @name deployments
 * @example deployments
 */
commander
    .command('deployments')
    .description('List deployment ids of a script')
    .action(utils_1.handleError(deployments_1.default));
/**
 * Creates a version and deploys a script.
 * The response gives the version of the deployment.
 * @name deploy
 * @example deploy (create new deployment and new version)
 * @example deploy --versionNumber 4 (create new deployment)
 * @example deploy --description "Updates sidebar logo." (deploy with description)
 * @example deploy --deploymentId 123 (create new version)
 * @example deploy -V 7 -d "Updates sidebar logo." -i 456
 */
commander
    .command('deploy')
    .description('Deploy a project')
    .option('-V, --versionNumber <version>', 'The project version') //we can't use `version` in subcommand
    .option('-d, --description <description>', 'The deployment description')
    .option('-i, --deploymentId <id>', 'The deployment ID to redeploy')
    .action(utils_1.handleError(deploy_1.default));
/**
 * Undeploys a deployment of a script.
 * @name undeploy
 * @param {string?} [deploymentId] The deployment ID.
 * @param {boolean?} all Setup StackDriver logs.
 * @example "undeploy" (undeploy the last deployment.)
 * @example "undeploy 123"
 * @example "undeploy --all"
 */
commander
    .command('undeploy [deploymentId]')
    .description('Undeploy a deployment of a project')
    .option('-a, --all', 'Undeploy all deployments')
    .action(utils_1.handleError(undeploy_1.default));
/**
 * Creates an immutable version of the script.
 * @name version
 * @param {string?} description The description of the script version.
 * @example version
 * @example version "Bump the version."
 */
commander
    .command('version [description]')
    .description('Creates an immutable version of the script')
    .action(utils_1.handleError(version_1.default));
/**
 * List versions of a script.
 * @name versions
 * @example versions
 */
commander
    .command('versions')
    .description('List versions of a script')
    .action(utils_1.handleError(versions_1.default));
/**
 * Lists your most recent 10 Apps Script projects.
 * @name list
 * @example list # helloworld1 â€“ xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx ...
 * @todo Add --all flag to list all projects.
 */
commander
    .command('list')
    .description('List App Scripts projects')
    .action(utils_1.handleError(list_1.default));
/**
 * Prints StackDriver logs.
 * @name logs
 * @param {boolean?} json Output logs in json format.
 * @param {boolean?} open Open StackDriver logs in a browser.
 * @param {boolean?} setup Setup StackDriver logs.
 */
commander
    .command('logs')
    .description('Shows the StackDriver logs')
    .option('--json', 'Show logs in JSON form')
    .option('--open', 'Open the StackDriver logs in the browser')
    .option('--setup', 'Setup StackDriver logs')
    .option('--watch', 'Watch and print new logs')
    .action(utils_1.handleError(logs_1.default));
/**
 * Remotely executes an Apps Script function.
 * This function runs your script in the cloud. You must supply
 * the functionName params. For now, it can
 * only run functions that do not require other authorization.
 * @name run
 * @param {string} functionName The function in the script that you want to run.
 * @param {boolean?} nondev Run script function in non-devMode.
 * @example run 'sendEmail'
 * @see https://developers.google.com/apps-script/api/reference/rest/v1/scripts/run
 * @requires `clasp login --creds` to be run beforehand.
 */
commander
    .command('run [functionName]')
    .description('Run a function in your Apps Scripts project')
    .option('--nondev', 'Run script function in non-devMode')
    .option('-p, --params [StringArray]', 'Add parameters required for the function as a JSON String Array')
    .action(utils_1.handleError(run_1.default));
/**
 * List, enable, or disable APIs for your project.
 * Currently, only list is supported.
 * @name apis
 * @example apis list
 * @example apis enable drive
 */
commander
    .command('apis')
    .description("List, enable, or disable APIs\n  list\n  enable <api>\n  disable <api>")
    .option('--open', 'Open the API Console in the browser')
    .action(utils_1.handleError(apis_1.default));
/**
 * Displays the help function.
 * @name help
 * @example help
 */
commander
    .command('help')
    .description('Display help')
    .action(utils_1.handleError(help_1.default));
/**
 * Update .clasp.json settings file.
 * If `newValue` is omitted, it returns the current setting value
 * If `settingKey` is omitted, it returns all keys in .clasp.json
 * @name setting
 * @param {string?} settingKey They key in .clasp.json you want to change
 * @param {string?} newValue The new value for the setting
 * @example setting
 * @example setting scriptId
 * @example setting scriptId new-id
 */
commander
    .command('setting [settingKey] [newValue]')
    .alias('settings')
    .description('Update <settingKey> in .clasp.json')
    .action(utils_1.handleError(setting_1.default));
/**
 * All other commands are given a help message.
 * @example random
 */
commander
    .command('*', undefined, { isDefault: true })
    .description('Any other command is not supported')
    .action(utils_1.handleError(defaultCmd_1.default));
/**
 * Displays clasp version
 */
commander.option('-v, --version').on('option:version', function () {
    console.log(require('../package.json').version);
});
// defaults to help if commands are not provided
if (!process.argv.slice(2).length) {
    commander.outputHelp();
}
// User input is provided from the process' arguments
commander.parse(process.argv);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFzQkEsbUJBQWlCO0FBRWpCLHFDQUF1QztBQUN2Qyx3Q0FBbUM7QUFDbkMsMENBQXFDO0FBQ3JDLDRDQUF1QztBQUN2QyxvREFBK0M7QUFDL0MsNENBQXVDO0FBQ3ZDLHNEQUFpRDtBQUNqRCx3Q0FBbUM7QUFDbkMsd0NBQW1DO0FBQ25DLDBDQUFxQztBQUNyQyw0Q0FBdUM7QUFDdkMsd0NBQW1DO0FBQ25DLDhDQUF5QztBQUN6Qyx3Q0FBbUM7QUFDbkMsd0NBQW1DO0FBQ25DLHNDQUFpQztBQUNqQyw4Q0FBeUM7QUFDekMsNENBQXVDO0FBQ3ZDLGdEQUEyQztBQUMzQyw4Q0FBeUM7QUFDekMsZ0RBQTJDO0FBQzNDLGlDQUFvRDtBQUVwRCxNQUFNO0FBRU47O0dBRUc7QUFDSCxTQUFTO0tBQ04sSUFBSSxDQUFDLG9CQUFZLENBQUM7S0FDbEIsS0FBSyxDQUFDLHFCQUFxQixDQUFDO0tBQzVCLFdBQVcsQ0FBSSxvQkFBWSwyQkFBd0IsQ0FBQyxDQUFDO0FBRXhEOzs7Ozs7OztHQVFHO0FBQ0gsU0FBUztLQUNOLE9BQU8sQ0FBQyxPQUFPLENBQUM7S0FDaEIsV0FBVyxDQUFDLDZCQUE2QixDQUFDO0tBQzFDLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRSx3REFBd0QsQ0FBQztLQUNsRixNQUFNLENBQUMsZ0JBQWdCLEVBQUUsMENBQTBDLENBQUM7S0FDcEUsTUFBTSxDQUFDLG1CQUFXLENBQUMsZUFBSyxDQUFDLENBQUMsQ0FBQztBQUU5Qjs7OztHQUlHO0FBQ0gsU0FBUztLQUNOLE9BQU8sQ0FBQyxRQUFRLENBQUM7S0FDakIsV0FBVyxDQUFDLFNBQVMsQ0FBQztLQUN0QixNQUFNLENBQUMsbUJBQVcsQ0FBQyxnQkFBTSxDQUFDLENBQUMsQ0FBQztBQUUvQjs7Ozs7Ozs7Ozs7Ozs7R0FjRztBQUNILFNBQVM7S0FDTixPQUFPLENBQUMs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